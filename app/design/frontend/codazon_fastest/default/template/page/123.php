<?php $_helper =Mage::helper("catalog/category"); $rootCat =Mage::app()->getStore()->getRootCategoryId(); $current =Mage::registry('current_category'); show_cat($current,$_helper,$rootCat);function show_cat($child,$_helper,$rootCat){if($child){//look for anchestor  $parentid = $child->getParentId(); $parent =Mage::getModel("catalog/category")->load($parentid);if($parentid != $rootCat){//find the anchestor show_cat($parent,$_helper,$rootCat);}else{//is root  $_subcategories = $parent->getChildrenCategories();if(count($_subcategories)>0){ echo '<ul>';foreach($_subcategories as $_category){ echo '<li>'; echo '<a rel="nofollow" href="'.$_helper->getCategoryUrl($_category).'">'.$_category->getName().'</a>';if($child->getId()== $_category->getId()){ $current =Mage::registry('current_category');if($current){//handle current $_current_subcategories = $current->getChildrenCategories();if(count($_current_subcategories)>0){//the current cat has childrens echo '<ul>';foreach($_current_subcategories as $_sub_category){ echo '<li>'; echo '<a rel="nofollow" href="'.$_helper->getCategoryUrl($_sub_category).'">'.$_sub_category->getName().'</a>'; echo '</li>';} echo '</ul>';}else{//the current cat has no childrens $current_parent = $current->getParentId(); $current_parent =Mage::getModel("catalog/category")->load($current_parent ); $_current_subcategories = $current_parent ->getChildrenCategories(); echo '<ul>';foreach($_current_subcategories as $_sub_category){ echo '<li>'; echo '<a rel="nofollow" href="'.$_helper->getCategoryUrl($_sub_category).'">'.$_sub_category->getName().'</a>'; echo '</li>';} echo '</ul>';}}} echo '</li>';} echo '</ul>';}}}}